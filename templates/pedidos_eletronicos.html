{% extends "base.html" %}

{% block title %}Relatório de Pedidos{% endblock %}

{% block content %}
<div class="container-fluid">
    <div class="card shadow mb-4">
        <div class="card-header bg-primary text-white py-3">
            <h6 class="m-0 font-weight-bold"><i class="bi bi-funnel"></i> Filtro de Pedidos por Vendedor</h6>
        </div>
        <div class="card-body">
            <form method="GET" action="{{ url_for('pedidos_eletronicos') }}" class="row g-3">
                <div class="col-md-4">
                    <label class="form-label font-weight-bold">Vendedor</label>
                    <select name="vendedor_id" class="form-select">
                        <option value="todos">-- Todos os Vendedores --</option>
                        {% for v in vendedores %}
                        <option value="{{ v[0] }}" {% if vendedor_id|string == v[0]|string %}selected{% endif %}>
                            {{ v[1] }}
                        </option>
                        {% endfor %}
                    </select>
                </div>
                <div class="col-md-3">
                    <label class="form-label font-weight-bold">Data Início</label>
                    <input type="date" name="data_inicio" class="form-control" value="{{ data_inicio }}">
                </div>
                <div class="col-md-3">
                    <label class="form-label font-weight-bold">Data Fim</label>
                    <input type="date" name="data_fim" class="form-control" value="{{ data_fim }}">
                </div>
                <div class="col-md-2 d-flex align-items-end">
                    <button type="submit" class="btn btn-success w-100">
                        <i class="bi bi-search"></i> Filtrar
                    </button>
                </div>
            </form>
        </div>
    </div>

    <div class="card shadow mb-4">
        <div class="card-header bg-dark text-white py-3">
            <h6 class="m-0 font-weight-bold">Listagem de Pedidos</h6>
        </div>
        <div class="card-body">
            <div class="table-responsive">
                <table class="table table-bordered table-hover" width="100%" cellspacing="0">
                    <thead class="thead-light">
                        <tr>
                            <th>Nº Pedido</th>
                            <th>Data</th>
                            <th>Vendedor</th>
                            <th class="text-right">Valor Total</th>
                            <th class="text-center">Status</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for pedido in pedidos %}
                        <tr>
                            <td>{{ pedido[0] }}</td>
                            <td>{{ pedido[1].strftime('%d/%m/%Y %H:%M') if pedido[1] else '' }}</td>
                            <td>{{ pedido[3] }}</td>
                            <td class="text-right font-weight-bold">R$ {{ "%.2f"|format(pedido[2]) }}</td>
                            <td class="text-center">
                                <span class="badge bg-info text-dark">
                                    {{ 'Pendente' if pedido[4] == 'P' else 'Digitado' if pedido[4] == 'D' else pedido[4] }}
                                </span>
                            </td>
                        </tr>
                        {% else %}
                        <tr>
                            <td colspan="5" class="text-center text-muted py-4">
                                <i class="bi bi-exclamation-circle"></i> Nenhum pedido encontrado para este filtro.
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>
{% endblock %}